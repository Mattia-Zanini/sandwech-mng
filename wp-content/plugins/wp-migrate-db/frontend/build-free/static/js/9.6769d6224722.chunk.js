(this.webpackJSONPwpmdb=this.webpackJSONPwpmdb||[]).push([[9],{827:function(e,t,n){"use strict";n.r(t);var c=n(10),a=n(0),r=n.n(a),i=n(142),s=n(7),u=n(1),o=n(32),b=n(48),l=n(4),f=n.n(l),p=n(8),d=n(6),O=(n(73),n(313)),j=n(177),_=n(5),m=n(66),v=n(55),k=n(3),h=function(e){return e.dbi_api_data};var g=n(49);function x(e){return function(){var t=Object(p.a)(f.a.mark(function t(n){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(Object(_.c)({preRequest:Object(s.b)(function(){n(Object(m.c)("licence_action",!0)),n(Object(m.a)("licence"))}),asyncFn:e,requestFailed:function(e){var t,c;n((t=e,c="licence_action",function(e){return e(Object(m.d)("licence",Object(u.a)("API error: ")+Object(v.a)(t))),e(Object(m.c)(c,!1)),!1}))},requestSuccess:function(e){n(Object(m.c)("licence_action",!1))}}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}function w(e,t){return function(n){var a=e.data,r=a.errors;if(r){if(n(Object(m.c)(t,!1)),Object.keys(r).length>0){var i=Object.keys(r),s=Object(c.a)(i,1)[0];a.hasOwnProperty("licence_status")&&(s=a.licence_status),n(E(s))}n(Object(d.a)(O.i,r))}else n(E("active_licence"))}}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(){var n=Object(p.a)(f.a.mark(function n(c,a){var r,i,u,o,l;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(b.a)("licence",a()),f="api_time",p=a(),i=Object(k.c)(h,"settings",f,p),u=Date.now()-i,36e5,t||!(u<36e5)){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,c(e(Object(_.b)("/check-license",{licence:r,context:"all",message_context:"settings"},!1,c)));case 8:if(o=n.sent){n.next=11;break}return n.abrupt("return",null);case 11:return l=o.data,c(w(o,"check_licence")),Object(s.b)(function(){c(Object(d.a)(O.c,o.data)),c(Object(d.a)(O.d,Date.now())),c(function(e){Object(_.b)("/local-site-details").then(function(t){t.success&&e(Object(d.a)(g.c,t.data))})}),t&&c(Object(j.b)())}),n.abrupt("return",l);case 15:case"end":return n.stop()}var f,p},n)}));return function(e,t){return n.apply(this,arguments)}}()}function E(e){return function(){var t=Object(p.a)(f.a.mark(function t(n){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n(Object(d.a)(O.h,e)));case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}var S=Object(s.c)(function(e){return{settingsStatus:Object(b.a)("status",e)}},{checkLicenceAgain:function(e,t){return function(){var n=Object(p.a)(f.a.mark(function n(c,a){var r,i;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c(Object(m.c)("check_again",!0)),r=x,e&&!t&&(r=function(){return t=e,function(){var e=Object(p.a)(f.a.mark(function e(n){var c,a,r,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(x(Object(_.b)("/activate-license",{licence_key:t,context:"all",message_context:"settings"},!1,n)));case 2:if(c=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:if(a=c.data,r=a.errors,i=a.error_type,n(w(c,"licence_action")),"undefined"!==typeof c.data.dbrains_api_down?(n(Object(d.a)(O.e,!0)),n(Object(j.b)()),n(y())):n(Object(d.a)(O.e,!1)),!r){e.next=11;break}if(Object.keys(r).includes("subscription_expired")){e.next=11;break}return e.abrupt("return",!1);case 11:return 1===Number(c.data.is_first_activation)&&"subscription_expired"!==i&&n(Object(d.a)(O.f,"first_activation")),"subscription_expired"!==i&&n(Object(d.a)(O.g,!0)),c.success&&c.data&&Object(s.b)(Object(p.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"subscription_expired"!==i&&n(E("active_licence")),n(Object(j.b)()),n(Object(m.f)("masked_licence",c.data.masked_licence)),n(Object(d.a)(O.c,c.data)),"subscription_expired"!==i&&n(Object(d.a)(O.i,[])),n(y());case 6:case"end":return e.stop()}},e)}))),setTimeout(function(){n(Object(d.a)(O.g,!1))},2500),e.abrupt("return",c);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();var t}),n.next=5,c(y(r,!0));case 5:return i=n.sent,c(Object(m.c)("check_again","success")),n.abrupt("return",i);case 8:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}()}})(function(e){var t,n,c=!1,a=e.settingsStatus,i=e.settings;return i&&(t=i.licence,n=i.masked_licence),a.check_again&&(c=!0===a.check_again),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"flex-container licence-action"},r.a.createElement("a",{onClick:function(){e.checkLicenceAgain(t,n)}},Object(u.a)("Check my license again","wp-migrate-db")),r.a.createElement("div",{className:"relative"},c&&r.a.createElement(o.d,{className:"license-notification-spinner"}))))}),N=n(93),C=function(e){var t=e.settings,n=t.status,c=t.errors,a=n.disable_ssl;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"flex-container licence-action"},r.a.createElement("button",{className:"btn-tooltip-stroke",onClick:function(){return e.disableSSL()}},Object(u.c)(Object(u.a)("Temporarily disable SSL for connections to %s","wp-migrate-db"),"api.deliciousbrains.com")),r.a.createElement(N.b,{position:!1,condition:a,errorMsg:c.disable_ssl,spinnerCond:a&&!0===a})))};t.default=function(e){var t=Object(s.e)(function(e){return e.dbi_api_data.licence}),n=t.license_ui_status,u=t.licence_status,o=Object(a.useState)(null),b=Object(c.a)(o,2),l=b[0],f=b[1],p=["subscription_expired","licence_not_found","no_activations_left"];return Object(a.useEffect)(function(){Object(i.includes)(p,u)&&f(r.a.createElement(S,e))},[]),l||(""===n?null:"check_again"===n?r.a.createElement(S,e):"connection_failed"===n?r.a.createElement(C,e):null)}}}]);